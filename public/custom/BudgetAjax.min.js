$(document).ready(function(){function t(){for(var t=0,e=0;e<s.length;e++)t+=parseFloat(s[e].value,10);if($("#budget_per_student").val(t),$("#budget_per_student").val().length>0){var a,n,l=(a=parseFloat($("#budget_amount").val()))/(n=parseFloat($("#budget_per_student").val()));$("#slot_count").val(Math.floor(l))}}function e(){$.get(n+"/getlatest",function(t){$(".slot").text(t.slot_count),$(".budget").text(t.amount)})}$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}});var a=$("#budget-table").DataTable({responsive:!0,processing:!0,serverSide:!0,ajax:dataurl,order:[3,"desc"],columnDefs:[{width:"130px",targets:4}],fnRowCallback:function(t,e,a,n){$("td:eq(0),td:eq(1)",t).addClass("text-right")},columns:[{data:"amount",name:"amount"},{data:"budget_per_student",name:"budget_per_student"},{data:"slot_count",name:"slot_count"},{data:"budget_date",name:"budget_date"},{data:"action",name:"action",orderable:!1,searchable:!1}]}),n="/coordinator/budget",l="";$("#add_budget").on("hide.bs.modal",function(){$("#frmBudget").trigger("reset"),$(".form-control").val()}),$(".btn-status").click(function(){0==$(this).val()?($(".btn-status").val(1),$("#add_budget").modal("show"),$("#h4").text("Add Budget"),$("#btn-save").val("add")):swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"End",cancelButtonText:"Cancel",closeOnConfirm:!1,allowOutsideClick:!0,showLoaderOnConfirm:!0,closeOnCancel:!0},function(t){setTimeout(function(){t&&$.get(n+"/end",function(t){$(".callout").removeClass().addClass("callout callout-danger"),$("h5").text("Closed"),$(".btn-status").removeClass().addClass("btn btn-success btn-status").html("<i class='fa fa-refresh'></i> Start"),$(".btn-status").val(0),a.draw(),e(),swal({title:"Ended!",text:"<center>Semester Closed</center>",type:"success",timer:1e3,showConfirmButton:!1,html:!0})}).fail(function(t){swal({title:"Failed!",text:"<center>Cannot Close</center>",type:"error",confirmButtonClass:"btn-success",showConfirmButton:!0,html:!0})})},500)})}),$("#budget-list").on("click",".btn-view",function(){var t=$(this).val();$.get(n+"/"+t,function(t){var e="<div class='col-xs-12 row'><div class='col-xs-6'><div class='form-group'><label>Budget Amount:</label><br>"+t[0].amount+"</div><div class='form-group'><label>Scholar Budget:</label><br>"+t[0].budget_per_student+"</div></div><div class='col-xs-6'><div class='form-group'><label>Date Inputted:</label><br>"+t[0].date+"</div><div class='form-group'><label>Slot:</label><br>"+t[0].slot_count+"</div></div>";$.each(t,function(t,a){e+="<div class='col-xs-6'><div class='form-group'><label>"+a.description+" Amount:</label><br>"+a.allocation_amount+"</div></div>"}),e+="</div>",bootbox.alert({title:"View Budget",message:e,backdrop:!0,buttons:{ok:{label:"Ok",className:"btn-success btn-md"}}})})}),$("#budget-list").on("click",".open-modal",function(){var t=$(this).val();l=t,$.get(n+"/"+t+"/edit",function(t){$("#budget_amount").val(t[0].amount),$("#budget_per_student").val(t[0].budget_per_student),$("#slot_count").val(t[0].slot_count),$.each(t,function(t,e){$("#id"+e.allocation_id).val(e.allocation_amount),$(".allocate").append("<input type='hidden' name='allocation_id[]' value='"+e.allocate_id+"'>")}),$("#h4").text("Edit Budget"),$("#btn-save").val("update"),$("#add_budget").modal("show")}).fail(function(t){$.notify({icon:"fa fa-warning",message:t.responseText.replace(/['"]+/g,"")},{type:"warning",z_index:2e3,delay:5e3})})}),$("#budget_amount").blur(function(){t()});for(var o=document.getElementsByName("amount[]"),s=Array.prototype.slice.call(o),d=0;d<s.length;d++)s[d].addEventListener("blur",t);$("#btn-save").click(function(){if($("#frmBudget").parsley().destroy(),$("#frmBudget").parsley().isValid()){$("#btn-save").attr("disabled","disabled"),setTimeout(function(){$("#btn-save").removeAttr("disabled")},1e3);var t=$("#frmBudget").serialize(),o=$("#btn-save").val(),s="POST",d=n;"update"==o&&(s="PUT",d+="/"+l),$.ajax({type:s,url:d,data:t,dataType:"json",success:function(t){$("#add_budget").modal("hide"),$(".callout").removeClass().addClass("callout callout-success"),$("h5").text("Renewal Phase Ongoing"),$(".btn-status").removeClass().addClass("btn btn-danger btn-status").html("<i class='fa fa-remove'></i> End"),a.draw(),e(),swal({title:"Success!",text:"<center>Data Stored</center>",type:"success",timer:1e3,showConfirmButton:!1,html:!0})},error:function(t){$.notify({icon:"fa fa-warning",message:t.responseText.replace(/['"]+/g,"")},{type:"warning",z_index:2e3,delay:5e3})}})}})});