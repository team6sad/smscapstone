$(document).ready(function(){function e(e,l){var a=$(e).offset().top-l;$(window).scrollTop()!=a&&$("html, body").stop().animate({scrollTop:a},0)}function l(e,l){var a=e.data("number-of-steps"),t=e.data("now-value"),o=0;"right"==l?o=t+100/a:"left"==l&&(o=t-100/a),e.attr("style","width: "+o+"%;").data("now-value",o)}function a(e){if(f.removeClass("current").eq(e).addClass("current"),1!=e){$(".form-navigation .previous").toggle(e>0);var l=e>=f.length-1;$(".form-navigation .next").toggle(!l)}else $(".form-navigation .previous").show(),$(".form-navigation .next").toggle()}function t(){return f.index(f.filter(".current"))}function o(){p?($("#academic").toggle(!1),$("#grade").empty()):($("#academic").toggle(!1).toggle(),$("#grade").empty(),$.get(d+"/grade/"+$("#intPersCurrentSchool").val(),function(e){var l="";$.each(e,function(e,a){l+="<option value="+a.grade+">"+a.grade+"</option>"});var a="<div class='form-group col-md-6'><label class='control-label'>Description</label><input id='subject_description' class='form-control subject_description' maxlength='45' required='required' autocomplete='off' data-parsley-pattern='^[a-zA-Z0-9 ]+$' name='subject_description[]' type='text'></div><div class='form-group col-md-2'><label class='control-label'>Units</label><input id='units' class='form-control units' maxlength='1' autocomplete='off' required='required' data-parsley-pattern='^[0-9 ]+$' name='units[]' type='text'></div><div class='form-group col-md-4'><label class='control-label'>Grade</label><select id='subject_grade' class='form-control subject_grade' name='subject_grade[]'>"+l+"</select></div>";$("#grade").append(a)}),r(),$(".subject_description").parsley(),$(".units").parsley(),$(".subject_grade").parsley())}function r(){$.get(d+"/credit/"+$("#intPersCurrentSchool").val()+"/"+$("#intPersCurrentCourse").val(),function(e){for(var l="",a="",t=1;t<=e.year;t++)l+="<option value="+t+">"+i(t)+"</option>";for(t=1;t<=e.semester;t++)a+="<option value="+t+">"+i(t)+"</option>";var o="<select class='form-control' id='year' name='year'>"+l+"</select>";$(".yearCredit").empty().append(o);var r="<select class='form-control' id='semester' name='semester'>"+a+"</select>";$(".semCredit").empty().append(r)})}function i(e){return 1==e?"First":2==e?"Second":3==e?"Third":4==e?"Fourth":5==e?"Fifth":void 0}var n=0,s=0,c="",d="/apply",u=0,b=0,v=new Date,p=1,m=0;v.setFullYear((new Date).getFullYear()-18),$("#datepicker").datepicker({viewMode:"years",endDate:v,autoclose:!0,format:"yyyy-mm-dd"}),window.Parsley.on("field:error",function(e){if("file"==e.$element[0].type){("strApplPicture"==e.$element[0].name?$(".images"):$(".pdf")).popover({trigger:"manual",container:"body",placement:"auto",content:function(){return e.getErrorsMessages().join(";")}}).popover("show")}else"textarea"==e.$element[0].type?e.$element.popover({trigger:"manual",container:"body",placement:"auto",content:function(){return e.getErrorsMessages().join(";")}}).popover("show"):(e.$element.val(""),e.$element.attr("placeholder",e.getErrorsMessages().join(";")))}),window.Parsley.on("field:success",function(e){if("file"==e.$element[0].type){("strApplPicture"==e.$element[0].name?$(".images"):$(".pdf")).popover("destroy")}else"textarea"==e.$element[0].type&&e.$element.popover("destroy");e.$element.removeAttr("placeholder")});var f=$(".form-section");$.backstretch("../../img/backgrounds/1apply.jpg"),$(".f1 .form-section:first").fadeIn("slow"),e($(".f1"),20),$(".form-navigation .previous").click(function(){$("#frmApply").parsley().destroy(),$('input[type="text"], textarea').removeAttr("placeholder"),u--,a(t()-1);var o=$(this).parents(".f1").find(".f1-step.active"),r=$(this).parents(".f1").find(".f1-progress-line");o.removeClass("active").prev().removeClass("activated").addClass("active"),l(r,"left"),$(this).prev().fadeIn(),e($(".f1"),20)}),$(".form-navigation .next").click(function(){var o=!0;if($(".f1").parsley().validate({group:"block-"+t()})&&(2==u&&b&&$("#strSiblDateFrom").val()>=$("#strSiblDateTo").val()&&(o=!1,alert("Date To Must Not be equal or less than Date From")),o)){a(t()+1);var r=$(this).parents(".f1").find(".f1-step.active"),i=$(this).parents(".f1").find(".f1-progress-line");r.removeClass("active").addClass("activated").next().addClass("active"),l(i,"right"),$(this).next().fadeIn(),e($(".f1"),20),u++}if(5==u){var s=$('input[name="strPersOrganization[]"]').length,v="<label>Councilor:</label> "+c+" <br><hr><label>Personal Info </label> <br><label>Applicant's Name:</label> "+$("#fname").val()+" "+$("#mname").val()+" "+$("#lname").val()+" <br><label>Gender:</label> "+$("select[name='PersGender'] option:selected").text()+"<br><label>Birth Date:</label> "+$("#datepicker").val()+" <br><label>Place of Birth:</label> "+$("#pob").val()+" <br><label>Religion:</label> "+$("#strPersReligion").val()+" <br><label>Address:</label> "+$("#strApplHouseNo").val()+" "+$("#stname").val()+" "+$("select[name='intBaraID'] option:selected").text()+"  <br><label>Mobile Number:</label> "+$("#strUserCell").val()+" <br><label>Email Address:</label> "+$("#email").val()+" <br><hr><label>Family Background</label> <br><div class='row'><div class='col-md-6'><label>Mother's Name:</label> "+$("#motherfname").val()+" "+$("#motherlname").val()+" <br><label>Citizenship:</label> "+$("#mothercitizen").val()+" <br><label>Highest Attainment:</label> "+$("#motherhea").val()+" <br><label>Occupation:</label> "+$("#motheroccupation").val()+" <br><label>Monthly Income:</label> "+$("select[name='motherincome'] option:selected").text()+" <br></div><div class='col-md-6'><label>Father's Name:</label> "+$("#fatherfname").val()+" "+$("#fatherlname").val()+" <br><label>Citizenship:</label> "+$("#fathercitizen").val()+" <br><label>Highest Attainment:</label> "+$("#fatherhea").val()+" <br><label>Occupation:</label> "+$("#fatheroccupation").val()+" <br><label>Monthly Income:</label> "+$("select[name='fatherincome'] option:selected").text()+" <br></div></div><div class='row'><div class='col-md-6'><label>Number of Brother/s:</label> "+$("#brono").val()+" <br><label>Number of Sister/s:</label> "+$("#sisno").val()+" <br></div>";if(b&&(v+="<div class='col-md-6'><label>From:</label> "+$("#strSiblFirstName").val()+" "+$("#strSiblLastName").val()+" <br><label>To:</label> "+$("#strSiblDateFrom").val()+" To: "+$("#strSiblDateTo").val()+" <br></div>"),v+="</div><hr><label>Educational Background</label> <br><div class='row'><div class='col-md-6'><label>Elementary</label> <br><label>School Name:</label> "+$("#elemschool").val()+" <br><label>Year Enrolled:</label> "+$("#elemenrolled").val()+" <br><label>Year Graduated:</label> "+$("#elemgrad").val()+" <br><label>Achievements/Honors:</label> "+$("#elemhonors").val()+" <br></div><div class='col-md-6'><label>High School</label> <br><label>School Name:</label> "+$("#hschool").val()+" <br><label>Year Enrolled:</label> "+$("#hsenrolled").val()+" <br><label>Year Graduated:</label> "+$("#hsgrad").val()+" <br><label>Achievements/Honors:</label> "+$("#hshonor").val()+" <br></div></div><hr><label>College</label> <br><div class='row'><div class='col-md-6'><label>School/University Currently Enrolled In:</label> "+$("select[name='intPersCurrentSchool'] option:selected").text()+" <br></div><div class='col-md-6'><label>Current Course:</label> "+$("select[name='intPersCurrentCourse'] option:selected").text()+" <br></div></div>",console.log(p),0==p){v+="<br><label>Grade</label> <br><div class='row'>";for(f=0;f<=m;f++)v+="<div class='col-md-4'><label>Description:</label> "+$(".subject_description")[f].value+" <br></div><div class='col-md-4'><label>Units:</label> "+$(".units")[f].value+"<br></div><div class='col-md-4'><label>Grade:</label> "+$(".subject_grade")[f].value+"<br></div>";v+="</div>"}v+="<hr><label>Community Involvement/Affiliation</label> <br><div class='row'>";for(var f=0;f<s;f++)""!=$(".organization")[f].value&&""!=$(".position")[f].value?v+="<div class='col-md-6'><label>Organization:</label> "+$(".organization")[f].value+" <br></div><div class='col-md-3'><label>Position:</label> "+$(".position")[f].value+" <br></div><div class='col-md-3'><label>Year of Participation:</label> "+$(".year")[f].value+" <br></div>":v+="<div class='col-md-6'><label>Organization:</label> N/A <br></div><div class='col-md-3'><label>Position:</label> N/A <br></div><div class='col-md-3'><label>Year of Participation:</label> N/A <br></div>";v+="</div><hr><label>Essay:</label> "+$("#essay").val().substring(0,50)+"... <br>",$("#summary").empty().append(v)}1==u&&(n=$("#intBaraID").val(),$.get(d+"/"+n,function(e){$("#councilor").empty(),$.each(e,function(e,l){var a="<div class='col-md-6'><div class='box box-widget councilor widget-user-2 text-center' style='cursor: pointer; background-color: #4A5459; border-style: solid;' value="+l.id+"><div class='widget-user-header'><div class='widget-user-image'><img class='profile-user-img img-responsive img-square' src='"+asset+"/"+l.picture+"' alt='User Avatar'></div><h3 class='widget-user-username text-widget' id=countxt"+l.id+">"+l.strCounName+"</h3><h5 class='widget-user-desc slot text-widget' id='slot"+l.id+"'>&emsp;</h5></div></div></div>";$("#councilor").append(a)}),$("#intDistID").val(e[0].district_id)}))}),f.each(function(e,l){$(l).find(":input").attr("data-parsley-group","block-"+e)}),a(0),$("#councilor").on("click",".councilor",function(){s=$(this).attr("value"),$("#intCounID").val(s),c=$("#countxt"+s).text(),$.get(d+"/school/"+s,function(e){var l="";$.each(e,function(e,a){l+="<option value="+a.id+">"+a.description+"</option>"}),$("#intPersCurrentSchool").empty().append(l)}),$.get(d+"/course/"+s,function(e){var l="";$.each(e,function(e,a){l+="<option value="+a.id+">"+a.description+"</option>"}),$("#intPersCurrentCourse").empty().append(l)}),$.get(d+"/question/"+s,function(e){$(".question").empty().append(e.essay)}),$(".form-navigation .next").click()}),$('input[name="rad"]').on("ifClicked",function(e){"yes"==this.value?(b=1,$("#questionappear").show("slide",{direction:"up"},1e3)):(b=0,$("#questionappear").hide())}),$.each($('input[name="rad"]'),function(e,l){$(this).attr("checked")&&"yes"==$(this).attr("id")&&(b=1,$("#questionappear").show("slide",{direction:"up"},1e3))}),$('input[name="col"]').on("ifClicked",function(e){"no"==this.value?($("#college").show("slide",{direction:"up"},1e3),p=0):($("#college").hide(),p=1),o()}),$.each($('input[name="col"]'),function(e,l){$(this).attr("checked")&&("no"==$(this).attr("id")?(p=0,$("#college").show("slide",{direction:"up"},1e3)):$(".academic").toggle())}),$("input").iCheck({radioClass:"iradio_flat-red"}),$("#frmApply").bind("keypress",function(e){if(3!=u&&13==e.keyCode)return $("#btn-next").click(),!1}),$(".btn-submit").on("click",function(e){e.preventDefault(),swal({title:"Are you sure?",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-success",confirmButtonText:"Apply",cancelButtonText:"Cancel",closeOnConfirm:!1,allowOutsideClick:!0,showLoaderOnConfirm:!0,closeOnCancel:!0},function(e){setTimeout(function(){e&&$("#frmApply").submit()},500)})}),$(".affiliation").click(function(){var e="<div class='add'><div class='form-group col-md-6'><label>Organization</label>"+$(".organization")[0].outerHTML+"</div><div class='form-group col-md-3'><label>Position</label>"+$(".position")[0].outerHTML+"</div><div class='form-group col-md-3'><label>Year of Participation</label><button type='button' class='btn btn-xs btn-danger pull-right removeorg'><i class='fa fa-remove'></i></button><div class='input-group'><div class='input-group-addon'><i class='fa fa-calendar'></i></div>"+$(".year")[0].outerHTML+"</div></div></div>";$("#affiliation").append(e)}),$(".grade").click(function(){if(p)$("#grade").empty(),m=0;else{m++;var e="<div class='add'><div class='form-group col-md-6'><label>Description</label>"+$(".subject_description")[0].outerHTML+"</div><div class='form-group col-md-2'><label>Units</label>"+$(".units")[0].outerHTML+"</div><div class='form-group col-md-4'><label>Grade</label><button type='button' class='btn btn-xs btn-danger pull-right removegrade'><i class='fa fa-remove'></i></button>"+$(".subject_grade")[0].outerHTML+"</div></div>";$("#grade").append(e)}}),$("#affiliation").on("click",".removeorg",function(){$(this).parent().parent().remove()}),$("#grade").on("click",".removegrade",function(){$(this).parent().parent().remove()}),$(".barangay").select2(),$(".dropdownbox").select2(),o(),$("#intPersCurrentSchool").change(function(){o(),r()}),$("#intPersCurrentCourse").change(function(){r()}),$("#councilor").on("mouseenter",".councilor",function(){$.get(d+"/count/"+$(this).attr("value"),function(e){$("#slot"+e.id).text("Slot:"+e.slot+"/"+e.max+" - Queue:"+e.queued)})})});